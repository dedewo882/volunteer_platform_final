{% extends 'volunteer/base.html' %}
{% block content %}
<div class="row">
  <!-- 左侧个人信息卡片 (无变化) -->
  <div class="col-md-4">
    <div class="card shadow-sm mb-4">
      <div class="card-header bg-primary text-white">
        <h4 class="mb-0"><i class="bi bi-person-circle"></i> 个人信息</h4>
      </div>
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-start">
          <h5 class="card-title">{{ user.first_name }}</h5>
          <a href="{% url 'edit_profile' %}" class="btn btn-sm btn-outline-primary">编辑信息</a>
        </div>
        <p class="card-text text-muted">学号: {{ profile.student_id }}</p>
        <ul class="list-group list-group-flush">
          <li class="list-group-item">性别: {{ profile.gender }}</li>
          <li class="list-group-item">年级: {{ profile.grade.name }}</li>
        </ul>
      </div>
    </div>
    <div class="card shadow-sm">
       <div class="card-header bg-info text-white">
        <h4 class="mb-0"><i class="bi bi-graph-up"></i> 志愿者数据</h4>
      </div>
      <div class="card-body">
        <ul class="list-group list-group-flush">
          <li class="list-group-item d-flex justify-content-between align-items-center">
            总服务时长 <span class="badge bg-success rounded-pill">{{ profile.total_hours }} 小时</span>
          </li>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            总经验值 <span class="badge bg-warning rounded-pill">{{ profile.total_xp }} XP</span>
          </li>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            当前等级 <span class="badge bg-primary rounded-pill">Lv. {{ profile.level }}</span>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- 右侧等级进度和报名记录 -->
  <div class="col-md-8">
    <div class="card shadow-sm mb-4">
      <div class="card-header">
        <h5 class="mb-0">等级进度 (Lv.{{ profile.level }} -> Lv.{{ profile.level|add:1 }})</h5>
      </div>
      <div class="card-body">
        <p class="text-muted">当前等级经验: {{ xp_in_level }} / 100 XP</p>
        
        <!-- === 核心修正部分 === -->
        <!-- 我们在父元素定义一个CSS变量，把Django的“暗号”放在这里 -->
        <div class="progress" style="height: 25px; --progress-percent: {{ xp_percent }}%;">
          <!-- 然后在子元素里，使用这个完全标准的CSS变量 -->
          <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: var(--progress-percent);" aria-valuenow="{{ xp_percent }}" aria-valuemin="0" aria-valuemax="100">{{ profile.total_xp }} XP</div>
        </div>
        
        <small class="form-text text-muted mt-2">
          距离下一级 ({{ next_level_xp }} XP) 还差 {{ 100|sub:xp_in_level }} 经验值。
        </small>
      </div>
    </div>

    <div class="card shadow-sm">
      <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-list-check"></i> 我的报名记录</h5>
      </div>
      <div class="list-group list-group-flush">
        {% for registration in registrations %}
          <a href="{% url 'activity_detail' registration.activity.id %}" class="list-group-item list-group-item-action">
            {{ registration.activity.title }}
            <small class="text-muted float-end">{{ registration.registered_at|date:"Y-m-d H:i" }}</small>
          </a>
        {% empty %}
          <div class="list-group-item">暂无报名记录。</div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
{% endblock %}