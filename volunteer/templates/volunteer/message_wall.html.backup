{% extends 'volunteer/base.html' %}
{% load static %}

{% block content %}
<style>
    /* èƒ¶å¸¦æ•ˆæœ */
    .tape {
        position: absolute;
        top: -15px;
        left: 50%;
        width: 100px;
        height: 30px;
        background-color: rgba(255, 255, 255, 0.4);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        z-index: 10;
        transform: translateX(-50%) rotate(-2deg);
    }

    /* æ‚¬æµ®åŠ¨ç”» */
    .note-card {
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        cursor: default;
    }

    .note-card:hover {
        transform: scale(1.05) rotate(0deg) !important;
        z-index: 100;
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2) !important;
    }

    /* é¢œè‰²ç±» */
    .note-warning {
        background: #fff3cd;
        color: #664d03;
    }

    .note-info {
        background: #cff4fc;
        color: #055160;
    }

    .note-success {
        background: #d1e7dd;
        color: #0f5132;
    }

    .note-danger {
        background: #f8d7da;
        color: #842029;
    }

    .note-primary {
        background: #cfe2ff;
        color: #084298;
    }

    /* é¢œè‰²é€‰æ‹©å™¨ */
    .color-option {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        cursor: pointer;
        border: 2px solid transparent;
        transition: transform 0.2s;
    }

    .color-option:hover {
        transform: scale(1.2);
    }

    .color-option.active {
        border-color: #333;
        transform: scale(1.1);
    }
</style>

<div class="container pb-5">
    <!-- é¡¶éƒ¨æ ‡é¢˜åŒº -->
    <div class="text-center mb-5 animate__animated animate__fadeInDown">
        <h1 class="fw-bold display-5 mb-3">ğŸ’¬ å¿—æ„¿è€…å¿ƒå£°å¢™</h1>
        <p class="text-muted lead">åˆ†äº«ä½ çš„æ„Ÿæ‚Ÿï¼Œæå‡ºä½ çš„å»ºè®®ï¼Œæˆ–è€…åªæ˜¯è®°å½•ä»Šå¤©çš„å¿ƒæƒ…ã€‚</p>
        <button class="btn btn-primary rounded-pill px-4 py-2 shadow-sm fw-bold mt-2" data-bs-toggle="modal"
            data-bs-target="#addMessageModal">
            <i class="bi bi-pencil-fill me-2"></i>æˆ‘è¦ç•™è¨€
        </button>
    </div>

    <!-- ç•™è¨€å±•ç¤ºåŒº (Masonry å¸ƒå±€æ¨¡æ‹Ÿ) -->
    <div class="row" data-masonry='{"percentPosition": true }'>

        {% for msg in messages_list %}

        <!-- å¡ç‰‡åˆ—å®¹å™¨ -->
        <div class="col-sm-6 col-lg-4 mb-5 animate__animated animate__fadeInUp"
            style="animation-delay: {{ forloop.counter0|add:1|divisibleby:10 }}00ms;">

            <!-- ä¾¿åˆ©è´´å¡ç‰‡ä¸»ä½“ -->
            <div class="card border-0 shadow-sm note-card note-{{ msg.color }} position-relative p-3"
                style="transform: rotate({{ forloop.counter|divisibleby:2|yesno:'1,-1' }}deg);">
                {% if msg.is_anonymous %}
                ?
                {% else %}
                {{ msg.user.first_name|slice:":1" }}
                {% endif %}
            </div>
            <small class="fw-bold opacity-75">
                {% if msg.is_anonymous %}
                åŒ¿åå¿—æ„¿è€…
                {% else %}
                {{ msg.user.first_name }}
                {% endif %}
            </small>
        </div>
        <small class="opacity-50" style="font-size: 0.8rem;">{{ msg.created_at|date:"m-d H:i" }}</small>
    </div>
</div>
</div>
</div>
{% empty %}
<!-- ç©ºçŠ¶æ€ -->
<div class="col-12 text-center py-5">
    <div class="text-muted opacity-50 display-1 mb-3"><i class="bi bi-clipboard"></i></div>
    <p class="text-muted">å¢™ä¸Šè¿˜æ˜¯ç©ºçš„ï¼Œå¿«æ¥è´´ä¸Šç¬¬ä¸€å¼ ä¾¿åˆ©è´´å§ï¼</p>
</div>
{% endfor %}
</div>
</div>

<!-- ç•™è¨€ Modal -->
<div class="modal fade" id="addMessageModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg rounded-4">
            <div class="modal-header border-0 pb-0">
                <h5 class="modal-title fw-bold">å†™ä¸‹ä½ çš„å¿ƒå£°</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-4">
                <form method="post" id="messageForm">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label class="form-label small text-muted fw-bold">å†…å®¹</label>
                        {{ form.content }}
                    </div>

                    <div class="mb-4">
                        <label class="form-label small text-muted fw-bold d-block">é€‰æ‹©ä¾¿åˆ©è´´é¢œè‰²</label>
                        <div class="d-flex gap-2">
                            <select name="color" id="id_color" class="d-none">
                                {% for value, label in colors %}
                                <option value="{{ value }}">{{ label }}</option>
                                {% endfor %}
                            </select>

                            <div class="color-option bg-warning shadow-sm active"
                                onclick="selectColor('warning', this)"></div>
                            <div class="color-option bg-info shadow-sm" onclick="selectColor('info', this)"></div>
                            <div class="color-option bg-success shadow-sm" onclick="selectColor('success', this)"></div>
                            <div class="color-option bg-danger shadow-sm" onclick="selectColor('danger', this)"></div>
                            <div class="color-option bg-primary shadow-sm" onclick="selectColor('primary', this)"></div>
                        </div>
                    </div>

                    <!-- éšç§é€‰é¡¹ -->
                    <div class="mb-3 bg-light p-3 rounded-3">
                        <label class="form-label small text-muted fw-bold d-block mb-2">éšç§è®¾ç½®</label>

                        <div class="form-check mb-2">
                            {{ form.is_public }}
                            <label class="form-check-label" for="id_is_public">
                                <strong>{{ form.is_public.label }}</strong>
                                <br><small class="text-muted">{{ form.is_public.help_text }}</small>
                            </label>
                        </div>

                        <div class="form-check">
                            {{ form.is_anonymous }}
                            <label class="form-check-label" for="id_is_anonymous">
                                <strong>{{ form.is_anonymous.label }}</strong>
                                <br><small class="text-muted">{{ form.is_anonymous.help_text }}</small>
                            </label>
                        </div>
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary rounded-pill py-2 fw-bold">å¼ è´´ç•™è¨€</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- ä½¿ç”¨æœ¬åœ° JS -->
<script src="{% static 'vendor/js/masonry.pkgd.min.js' %}"></script>

<script>
    // é˜²æ­¢é®ç½©å±‚ç›–ä½æ¨¡æ€æ¡†
    var modalElement = document.getElementById('addMessageModal');
    document.body.appendChild(modalElement);

    function selectColor(color, element) {
        document.getElementById('id_color').value = color;
        document.querySelectorAll('.color-option').forEach(el => el.classList.remove('active'));
        element.classList.add('active');
    }

    window.onload = function () {
        var row = document.querySelector('.row[data-masonry]');
        if (row) {
            new Masonry(row, {
                percentPosition: true
            });
        }
    }
</script>
{% endblock %}